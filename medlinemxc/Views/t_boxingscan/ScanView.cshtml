
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Boxing Scan</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="~/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="~/css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="~/css/style.min.css" rel="stylesheet">

    <style>
        .card {
            border-radius: 15px;
        }
    </style>
</head>

<body class="grey lighten-3">
    <!--Main layout-->
    <main id="main" class="pt-3 mx-md-2">
        <div class="container-fluid">

            <div class="row mb-2">

                <!--Grid column-->
                <div class="col-md-1 col-sm-1 px-2">
                    <a  id="brefresh" class="card primary-color-dark hoverable" style="height: 13vh">

                        <div class="text-center my-auto">
                            <h3 class="my-1" style="font-size: 5vh"><i class="fas fa-sync-alt white-ic"></i></h3>
                        </div>

                    </a>
                </div>
                <div class="col-md-3 col-sm-3 px-2">
                    <div class="card" style="height: 13vh">

                        <div class="text-center my-auto">
                            <h3 class="my-1" style="font-size: 3.5vh"><span class="font-weight-bold"> Linea:</span><span id="hlinea">@ViewBag.linea</span></h3>
                            <h3 class="my-1" style="font-size: 3vh"><span class="font-weight-bold"> WO:</span> <span id="hwo"></span></h3>
                        </div>

                    </div>
                </div>
                <div class="col-md-4 col-sm-4 px-2">
                    <div class="card" style="height: 13vh">

                        <div class="text-center my-auto">
                            <h3 class="my-1" style="font-size: 3.2vh"><span class="font-weight-bold"> Cajas:</span><span id="hcajas">0</span>/<span id="hcajast">0</span></h3>
                            <h3 class="my-1" style="font-size: 3.2vh"><span class="font-weight-bold"> Kits:</span> <span id="hkits">0</span>/<span id="hkitst">0</span></h3>
                        </div>

                    </div>
                </div>

                <div class="col-md-2 col-sm-2 px-2">
                    <div class="card" style="height: 13vh">
                        @if (ViewBag.enmeta == "1")
                        {
                            <div id="hdmeta" class="text-center my-auto">
                                <i class="fas fa-arrow-alt-circle-up my-1" style="color:#1b5e20; font-size:3.5vh"></i>
                                <p class="my-1"><h3 style="font-size:2.5vh">Dentro de meta</h3></p>
                            </div>
                        }
                        else
                        {
                            <div id="hfmeta" class="text-center my-auto">
                                <i class="fas fa-arrow-alt-circle-down my-1" style="color:#b71c1c; font-size:3.5vh"></i>
                                <p class="my-1"><h3 style="font-size:2.5vh">Fuera de meta</h3></p>
                            </div>
                        }
                    </div>
                </div>

                <div class="col-md-2 col-sm-2 px-2">
                    <div class="card" style="height: 13vh">

                        <div class="text-center my-auto">

                            <h3 class="my-1" style="font-size: 3.5vh" id="hhora">00:00</h3>
                            <h3 class="my-1" style="font-size: 2.5vh" id="hfecha"></h3>
                        </div>

                    </div>
                </div>

                



            </div>
            <div class="row mb-2">
                <div class="col-12">
                    <div class="progress" style="background-color:white; border-radius:100px;height:3.5vh">
                        <div id="hprogress" class="progress-bar bg-success progress-bar-striped font-weight-bold" style="width:0%;border-radius:100px;height:3.5vh;font-size:3.3vh">0%</div>
                    </div>
                </div>
            </div>



            <!-- Heading -->
            <!--Grid row-->
            <div class="row">

                <div class="col-md-6 col-sm-6 px-2">
                    <div class="card mb-2" style="height:15vh">

                        <!--Card content-->
                        <div class="card-body text-center my-auto">
                            <h3 class="mt-0 mb-1" style="font-size: 2.8vh">Lote</h3>
                            <input id="ilote" type="text" class="form-control">

                        </div>

                    </div>
                    <!--Card-->
                    <div class="card" style="height:38vh">

                        <!--Card content-->
                        <div class="card-body d-flex align-items-center justify-content-center">
                            <div class="text-center">
                                <h3 id="hcodinc" class="indicadores"  style="font-size: 5vh;display:none"><span class="badge badge-pill danger-color-dark">Código Incorrecto</span></h3>
                                <h3 id="hcodcor" class="indicadores"  style="font-size: 5vh;display:none"><span class="badge badge-pill success-color-dark">Código Correcto</span> </h3>
                                <h3 id="hcamwo" class="indicadores" style="font-size: 5vh;display:none"><span class="badge badge-pill primary-color-dark">Cambio de WO</span></h3>
                                <h3 id="hwocom" class="indicadores"  style="font-size: 5vh;display:none"><span class="badge badge-pill primary-color-dark">WO Completada</span></h3>
                            </div>
                        </div>

                    </div>
                    <!--/.Card-->

                </div>

                <div class="col-md-6 col-sm-6 px-2">

                    <!--Card-->
                    <div id="indincorrecto" class="card red lighten-4 indicadores" style="height:54vh;display:none">
                        <div class="text-center my-auto">
                            <i class="fas fa-ban" style="font-size:32vh; color:#b71c1c"></i>
                        </div>

                    </div>
                    <!--/.Card-->
                    <div  id="indcorrecto" class="card green lighten-4 indicadores" style="height:54vh;display:none">
                        <div class="text-center my-auto">
                            <i class="fas fa-check" style="font-size:32vh; color:#1b5e20"></i>
                        </div>
                    </div>

                    <div id="indcargando" class="card blue lighten-5 indicadores" style="height:54vh;display:none">
                        <div class="text-center my-auto">
                            <i class="fas fa-spinner" style="font-size:32vh; color:#0d47a1"></i>
                            <p class="my-3"><h3 style="font-size:3.5vh; color: #0d47a1">Cargando</h3></p>
                        </div>
                    </div>
                </div>


            </div>

            <div class="row mt-2">
                <div class="col-md-12 col-sm-12 px-2">
                    <div class="card">
                        <table class="table  table-sm mb-0">
                            <thead class="primary-color-dark text-white">
                                <tr>
                                    <th scope="col">Hora</th>
                                    <th scope="col">6-7</th>
                                    <th scope="col">7-8</th>
                                    <th scope="col">8-9</th>
                                    <th scope="col">9-10</th>
                                    <th scope="col">10-11</th>
                                    <th scope="col">11-12</th>
                                    <th scope="col">12-13</th>
                                    <th scope="col">13-14</th>
                                    <th scope="col">14-15</th>
                                    <th scope="col">Acum</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">Cajas</th>
                                    @foreach (var item in ViewBag.tablaprogreso)
                                    {
                                        if (item.consec <= ViewBag.consecactual)
                                        {
                                            if (item.cajas < item.meta)
                                            {
                                                <td class="font-weight-bold text-danger">@item.cajas</td>
                                            }
                                            else
                                            {
                                                <td class="font-weight-bold text-success">@item.cajas</td>
                                            }
                                        }
                                        else
                                        {
                                            <td class="@(ViewBag.consecactual + 1 == item.consec ? "blue lighten-5":"")">@item.cajas</td>
                                        }

                                    }
                                    @if (ViewBag.enmeta == "1")
                                    {
                                        <td class="font-weight-bold text-success">@ViewBag.tcajas</td>
                                    }
                                    else
                                    {
                                        <td class="font-weight-bold text-danger">@ViewBag.tcajas</td>
                                    }
                                   
                                </tr>
                                <tr>
                                    <th scope="row">Meta</th>
                                    @foreach (var item in ViewBag.tablaprogreso)
                                    {
                                        
                                        if (item.consec <= ViewBag.consecactual)
                                        {

                                            <td class="font-weight-bold">@item.meta</td>
                                        }
                                        else
                                        {
                                            <td class="@(ViewBag.consecactual + 1 == item.consec ? "blue lighten-5":"")">@item.meta</td>
                                        }

                                    }
                                    
                                    <td class="font-weight-bold">@ViewBag.tmeta</td>
                                </tr>
                                <tr>
                                    <th scope="row">T. Muerto</th>
                                    @foreach (var item in ViewBag.tablaprogreso)
                                    {
                                        if (item.consec <= ViewBag.consecactual)
                                        {

                                            <td class="font-weight-bold">@item.tmuerto</td>
                                        }
                                        else
                                        {
                                            <td class="@(ViewBag.consecactual + 1 == item.consec ? "blue lighten-5":"")">@item.tmuerto</td>
                                        }

                                    }
                                    <td class="font-weight-bold">@ViewBag.ttmuerto</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>

            </div>
        </div>





    </main>
    <!--Main layout-->
    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="~/js/jquery-3.4.0.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="~/js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="~/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="~/js/mdb.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>


    <!-- Charts -->
    <script>
        $(document).ready(function () {
            var treshold = @ViewBag.treshold;
            var linea = $("#hlinea").text();
            var meses = new Array("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre");
            var f = new Date();

            var scan;
            $('#hfecha').text(f.getDate() + "-" + meses[f.getMonth()] + "-" + f.getFullYear());

            clockUpdate();
            setInterval(clockUpdate, 10000);

            function clockUpdate() {
                var date = new Date();
                function addZero(x) {
                    if (x < 10) {
                        return x = '0' + x;
                    } else {
                        return x;
                    }
                }

                var h = addZero(date.getHours());
                var m = addZero(date.getMinutes());

                $('#hhora').text(h + ':' + m )
            }

            $('#ilote').keyup(function (e) {
                if (e.keyCode == 13) {
                    $(".indicadores").hide();
                    $("#indcargando").show();
                    scan = $("#ilote").val();
                    $("#ilote").val("");
                    if (scan.length > 7)
                    {
                        scan = scan.substr(scan.length - 8);
                        if (scan[0] == "2" && scan[3] == "M")
                        {
                            Scan();
                        }
                        else
                        {
                            CodIncorrecto();
                        }
                        
                    }
                    else
                    {
                        CodIncorrecto();
                    }
                }
            });

            function Scan() {
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("loteScan", "t_boxingscan")',
                    dataType: 'json',
                    data: { id: scan, linea : linea, treshold : treshold},
                    success: function (infoScan) {
                        $("#hwo").text(infoScan[1]);
                        $("#hcajast").text(infoScan[2]);
                        $("#hkitst").text(infoScan[3]);
                        $("#hcajas").text(infoScan[4]);
                        $("#hkits").text(infoScan[5]);
                        $("#hprogress").text(infoScan[6]);
                        $('#hprogress').css("width", infoScan[6]);
                        
                        if(infoScan[0] == "0")
                        {
                            CodCorrecto();
                        }
                        else
                        {
                            CambioWO();
                        }

                        if(infoScan[7] == "1")
                        {
                            WOCompleta();
                        }
                    },
                    error: function (ex) {
                        CodIncorrecto();
                    }
                });
            }
            

            function CodCorrecto(){
                $(".indicadores").hide();
                $("#hcodcor").show();
                $("#indcorrecto").show();
            }

            function CodIncorrecto(){
                $(".indicadores").hide();
                $("#hcodinc").show();
                $("#indincorrecto").show();
            }

            function CambioWO(){
                $(".indicadores").hide();
                $("#hcamwo").show();
                $("#indcorrecto").show();
            }

            function WOCompleta() {
                $("#hwocom").show();
            }

            window.setInterval(function () {
                doIt();
            }, 1000);


            function refresh() {
                window.location.reload();
            }

            $("#brefresh").click(function () {
                refresh();
            });

            function doIt() {
                var d, h, m, s;
                d = new Date();
                m = d.getMinutes();
                s = d.getSeconds();
                if ((m == 30 && s == 5) || (m == 0 && s == 5)) {
                    window.location.reload();
                }
            }

        });
    </script>


</body>

</html>